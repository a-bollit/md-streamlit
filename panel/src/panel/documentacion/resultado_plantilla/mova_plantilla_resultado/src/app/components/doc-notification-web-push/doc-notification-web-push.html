<section class="view-default-style">

  <!-- Componente -->
  <mv-card class="card-code">
    <mv-card-title><strong>Documentación notificaciones push web</strong></mv-card-title>

    <!-- Índice de la documentación -->
    <div>
      <a class="nostyle" (click)='info.scrollIntoView({behavior: "smooth",block: "start"})'>
        <mv-icon>link</mv-icon> Información
      </a>
    </div>
    <div>
      <a class="nostyle" (click)='config.scrollIntoView({behavior: "smooth",block: "start"})'>
        <mv-icon>link</mv-icon> Configuración
      </a>
    </div>
    <div>
      <a class="nostyle" (click)='useExample.scrollIntoView({behavior: "smooth",block: "start"})'>
        <mv-icon>link</mv-icon> Ejemplo de uso
      </a>
    </div>
    <p>Métodos:</p>
    <ol class="ol-code">
      <li><a class="nostyle" (click)='requestSubscriptionWebPushExample.scrollIntoView({behavior: "smooth",block: "start"})'>
        <mv-icon>link</mv-icon> requestSubscriptionWebPush
      </a></li>
      <li><a class="nostyle" (click)='unsubscribeWebPushExample.scrollIntoView({behavior: "smooth",block: "start"})'>
        <mv-icon>link</mv-icon> unsubscribeWebPush
      </a></li>
      <li><a class="nostyle" (click)='isSubscribedExample.scrollIntoView({behavior: "smooth",block: "start"})'>
        <mv-icon>link</mv-icon> isSubscribed
      </a></li>
    </ol>

  </mv-card>

  <!-- Información -->
  <mv-card class="card-code">

    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #info><strong>Información</strong></mv-card-title>
      <mv-card-subtitle>Información general de las notificaciones push web.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>El servicio de notificaciones push web de MOVA proporciona toda la funcionalidad necesaria para la suscripción y recepción de notificaciones push en navegador web</p>

      <p>Este servicio funciona de forma autónoma, lo único que debe hacer el desarrollador es definir qué debe realizar la app en caso de: </p>
      <ul>
        <li><a class="nostyle" (click)='onNotificationWebReceived.scrollIntoView({behavior: "smooth",block: "start"})'>
          onNotificationWebReceived
        </a>: recibir una notificación</li>
        <li><a class="nostyle" (click)='onNotificationWebClick.scrollIntoView({behavior: "smooth",block: "start"})'>
          onNotificationWebClick
        </a>: click en notificación</li>
      </ul>

    </mv-card-content>
  </mv-card>

  <!-- Configuración -->
  <mv-card class="card-code">

    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #config><strong>Configuración</strong></mv-card-title>
      <mv-card-subtitle>Configuración general de las notificaciones push.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>Primero debemos solicitar en la ficha de inicio de la app, la opción de notificaciones web push. La ficha devuelta por Arquitectura
      tendrá la clave pública y privada necesaria para el funcionamiento de las notificaciones push en web.</p>

      <p>Para configurar correctamente el servicio de notificaciones en nuestra app, tendremos que trasladar a las variables de entorno
        los valores de las claves que proporciona Arquitectura en la ficha de inicio de la app.</p>
      <p>También debemos trasladar los valores de las claves al backend.</p>

      <mv-tab-group>
        <mv-tab label="environment.ts">
          <pre><code [highlight]="codeEnvironmentTS"></code></pre>
        </mv-tab>
        <mv-tab label="environment.val.ts">
          <pre><code [highlight]="codeEnvironmentValTS"></code></pre>
        </mv-tab>
        <mv-tab label="environment.prod.ts">
          <pre><code [highlight]="codeEnvironmentProdTS"></code></pre>
        </mv-tab>

        <mv-tab label="enviar_web_push.js">
          <pre><code [highlight]="codeBackendJS"></code></pre>
        </mv-tab>
      </mv-tab-group>

    </mv-card-content>
  </mv-card>

  <!-- Ejempplo de uso -->
  <mv-card class="card-code">

    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #useExample><strong>Prueba de notificaciones web push</strong></mv-card-title>
      <mv-card-subtitle>Ejemplo para probar la recepción de notificaciones web push.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>Para probar el funcionamiento correcto de las notificaciones web push, realizar los siguientes pasos:</p>
      <ul>
        <li>
          Descargarse el backend en Node de ejemplo de envío de notificaciones:
          <a
            rel="noopener noreferrer"
            href="https://gestiona3.madrid.org/portalapps/util_archivos/enviar_web_push.zip"
            target="_blank">
            <strong>https://gestiona3.madrid.org/portalapps/util_archivos/enviar_web_push.zip</strong>
          </a>
        </li>
        <li><p>Situarse en el directorio de ejemplo enviar_web_push.js con la consola y ejecutar "npm install web-push"</p></li>
        <li>
          <p>Ejecutar el método requestSubscriptionWebPush()</p>
          <mv-button
            appearance="raised"
            color="primary"
            (clickEvent)="subscriptionClick()">
            requestSubscriptionWebPush()
          </mv-button>
          <p><strong>JSON de respuesta de requestSubscriptionWebPush():</strong></p>
          <p class="response">
            {{subscriptionResponse | json}}
          </p>
        </li>
        <li><p>Debemos aceptar recibir notificaciones en el navegador y si todo ha ido bien nos devolverá un JSON con una serie de datos</p></li>
        <li><p>Si no nos devuelve un JSON de datos, revisar los permisos del navegador para que se puedan recibir notificaciones. Si cambiamos algo recargar el navegador.</p></li>
        <p>1. Comprobamos si tenemos las notificaciones bloqueadas</p>
        <div id="web-push-img3">
          <img src="assets/examples/example-push-permission3.png" alt="Comprobación de notificaciones bloqueadas">
        </div>
        <p>2. En caso de tenerlas bloqueadas, pulsar en la campana y permitir</p>
        <div id="web-push-img2">
          <img src="assets/examples/example-push-permission2.png" alt="Permitir notificaciones">
        </div>
        <p>3. También se puede ver aquí</p>
        <div id="web-push-img1">
          <img src="assets/examples/example-push-permission.png"  alt="Permitir notificaciones desde información del sitio">
        </div>
        <li><p>Copiar el JSON devuelto entero y pegarlo en el valor correspondiente del archivo enviar_web_push.js.</p></li>
        <li><p>Ejecutar en la consola "node enviar_web_push.js"</p></li>
        <li><p>Si todo ha ido bien debemos haber recibido la notificación en la consola del navegador, en un alert del navegador y en las notificaciones del sistema operativo:</p></li>
        <div id="web-push-img4">
          <img alt="Ejemplo push" src="assets/examples/webpushexample.png">
        </div>
      </ul>

    </mv-card-content>
  </mv-card>

  <!-- onNotificationWebReceived -->
  <mv-card class="card-code">
    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #onNotificationWebReceived><strong>onNotificationWebReceived</strong></mv-card-title>
      <mv-card-subtitle>Evento de notificación.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>El evento onNotificationWebReceived (app.component.ts) permite definir el comportamiento de la app en caso de recibir una notificación.</p>
      <p>El evento por defecto viene vacío para que el desarrollador implemente el comportamiento adicional que desee que haga la app si lo desea.</p>

      <mv-tab-group>
        <mv-tab label="app.component.ts">
          <pre><code [highlight]="codeOnNotificationWebReceivedExampleTS"></code></pre>
        </mv-tab>
      </mv-tab-group>

    </mv-card-content>
  </mv-card>

  <!-- onNotificationWebClick -->
  <mv-card class="card-code">
    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #onNotificationWebClick><strong>onNotificationWebClick</strong></mv-card-title>
      <mv-card-subtitle>Evento de click en notificación.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>El evento onNotificationWebClick (app.component.ts) permite definir el comportamiento de la app en caso de hacer click en una notificación recibida.</p>
      <p>El evento por defecto viene vacío para que el desarrollador implemente el comportamiento adicional que desee que haga la app si lo desea.</p>

      <mv-tab-group>
        <mv-tab label="app.component.ts">
          <pre><code [highlight]="codeOnNotificationWebClickExampleTS"></code></pre>
        </mv-tab>
      </mv-tab-group>

    </mv-card-content>
  </mv-card>

  <!-- requestSubscriptionWebPush -->
  <mv-card class="card-code">
    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #requestSubscriptionWebPushExample><strong>requestSubscriptionWebPush</strong></mv-card-title>
      <mv-card-subtitle>Evento requestSubscriptionWebPush.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>El evento requestSubscriptionWebPush permite solicitar la suscripción a las notificaciones push en web.</p>

      <mv-tab-group>
        <mv-tab label="HTML">
          <pre><code [highlight]="codeOnRequestExampleHTML"></code></pre>
        </mv-tab>
        <mv-tab label="TS">
          <pre><code [highlight]="codeOnRequestExampleTS"></code></pre>
        </mv-tab>
      </mv-tab-group>

      <p><strong>Click en el método requestSubscriptionWebPush:</strong></p>
      <mv-button
        appearance="raised"
        color="primary"
        (clickEvent)="subscriptionClick()">
        requestSubscriptionWebPush()
      </mv-button>

      <p><strong>JSON de respuesta de requestSubscriptionWebPush():</strong></p>
      <p class="response">
        {{subscriptionResponse | json}}
      </p>
    </mv-card-content>
  </mv-card>

  <!-- unsubscribeWebPush -->
  <mv-card class="card-code">
    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #unsubscribeWebPushExample><strong>unsubscribeWebPush</strong></mv-card-title>
      <mv-card-subtitle>Evento unsubscribeWebPush.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>El evento unsubscribeWebPush permite eliminar la suscripción a las notificaciones push en web.</p>

      <mv-tab-group>
        <mv-tab label="HTML">
          <pre><code [highlight]="codeOnUnsubscribeExampleHTML"></code></pre>
        </mv-tab>
        <mv-tab label="TS">
          <pre><code [highlight]="codeOnUnsubscribeExampleTS"></code></pre>
        </mv-tab>
      </mv-tab-group>

      <p><strong>Click en el método unsubscribeWebPush:</strong></p>
      <mv-button
        appearance="raised"
        color="primary"
        (clickEvent)="unsubscribeClick()">
        unsubscribeWebPush()
      </mv-button>

      <p class="response"><strong>Respuesta de unsubscribeWebPush():</strong>
        {{unsubscriptionResponse | json}}
      </p>

    </mv-card-content>
  </mv-card>

  <!-- isSubscribed -->
  <mv-card class="card-code">
    <mv-card-header>
      <div mv-card-avatar><mv-icon>code</mv-icon></div>
      <mv-card-title #isSubscribedExample><strong>isSubscribed</strong></mv-card-title>
      <mv-card-subtitle>Evento isSubscribed.</mv-card-subtitle>
    </mv-card-header>

    <mv-card-content>

      <p>El evento isSubscribed permite consultar si estamos suscritos o no a las notificaciones push en web.</p>

      <mv-tab-group>
        <mv-tab label="HTML">
          <pre><code [highlight]="codeIsSubscribedExampleHTML"></code></pre>
        </mv-tab>
        <mv-tab label="TS">
          <pre><code [highlight]="codeIsSubscribedExampleTS"></code></pre>
        </mv-tab>
      </mv-tab-group>

      <p><strong>Click en el método isSubscribed:</strong></p>
      <mv-button
        appearance="raised"
        color="primary"
        (clickEvent)="isSubscribedClick()">
        isSubscribed()
      </mv-button>

      <p class="response"><strong>Respuesta de isSubscribed():</strong>
        {{isSubscribedResponse}}
      </p>

    </mv-card-content>
  </mv-card>


</section>

<mv-button-scroll-to-top>
</mv-button-scroll-to-top>
